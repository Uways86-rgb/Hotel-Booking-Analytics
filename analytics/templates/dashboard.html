{% extends 'base.html' %}

{% block title %}Booking Reviews Dashboard{% endblock %}

{% block content %}
    <header class="page-header">
        <h1>Hotel Booking Analytics</h1>
        <p>Monitor your hotel reviews and customer satisfaction metrics</p>
    </header>

    <section class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-icon">‚≠ê</div>
            </div>
            <div class="kpi-label">Average Rating</div>
            <div class="kpi-value rating">{{ avg_rating }}</div>
            <div class="kpi-trend up"><span>‚Üë</span> Above average</div>
        </div>

        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-icon">üìù</div>
            </div>
            <div class="kpi-label">Total Reviews</div>
            <div class="kpi-value">{{ total_reviews }}</div>
            <div class="kpi-trend up"><span>‚Üë</span> All time</div>
        </div>

        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-icon">‚ö†Ô∏è</div>
            </div>
            <div class="kpi-label">Negative Reviews</div>
            <div class="kpi-value">{{ negative_percent }}%</div>
            <div class="kpi-trend down"><span>‚Üì</span> Below threshold</div>
        </div>
    </section>

    <section class="charts-grid">
        <div class="chart-card">
            <div class="chart-header">
                <h2 class="chart-title">Top 5 Hotels by Rating</h2>
                <span class="chart-badge">Highest Rated</span>
            </div>
            <div class="chart-container">
                <canvas id="hotelsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h2 class="chart-title">Top 5 Countries by Rating</h2>
                <span class="chart-badge">By Province</span>
            </div>
            <div class="chart-container">
                <canvas id="countriesChart"></canvas>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
    <script>
        var hotelLabels = {{ top_hotels_json|safe }};
        var hotelData = {{ top_hotels_data|safe }};

        new Chart(document.getElementById('hotelsChart'), {
            type: 'bar',
            data: {
                labels: hotelLabels,
                datasets: [{
                    label: 'Average Rating',
                    data: hotelData,
                    backgroundColor: 'rgba(37, 99, 235, 0.8)',
                    borderColor: 'rgba(37, 99, 235, 1)',
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, max: 10 },
                    x: { ticks: { maxRotation: 45, minRotation: 0 } }
                }
            }
        });

        var countryLabels = {{ top_countries_json|safe }};
        var countryData = {{ top_countries_data|safe }};

        new Chart(document.getElementById('countriesChart'), {
            type: 'bar',
            data: {
                labels: countryLabels,
                datasets: [{
                    label: 'Average Rating',
                    data: countryData,
                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                    borderColor: 'rgba(16, 185, 129, 1)',
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, max: 10 },
                    x: { ticks: { maxRotation: 45, minRotation: 0 } }
                }
            }
        });
    </script>
{% endblock %}
